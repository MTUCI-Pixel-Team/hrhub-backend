name: Deploy to Ubuntu Server

on:
    push:
        branches:
            - dev-d # или ваша основная ветка

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
              with:
                  token: ${{ secrets.PAT }}

            - name: Install sshpass
              run: sudo apt-get install sshpass

            - name: Deploy to Server
              env:
                  HOST: ${{ secrets.HOST }}
                  USER: ${{ secrets.USER }}
                  PASSWORD: ${{ secrets.SERVER_PASSWORD }}
                  REPO_URL: ${{ secrets.REPO_URL }}
              run: |
                  sshpass -p $PASSWORD ssh -o StrictHostKeyChecking=no $USER@$HOST << EOF
                    cd /путь/к/вашему/проекту
                    if [ ! -d ".git" ]; then
                      git clone $REPO_URL .
                    else
                      git pull
                    fi
                    docker-compose down
                    docker-compose up --build -d
                  EOF
